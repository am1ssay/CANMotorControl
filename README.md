**Project Name:**  
**CANMotorControl**  
*Управление моторами и мониторинг энкодеров через CAN-интерфейс*

---

# CANMotorControl  
Комплексная система для управления шаговыми/DC моторами и мониторинга энкодеров через CAN-шину с графическим интерфейсом.

## Возможности  
✅ **Управление моторами:**  
- Шаговые двигатели (скорость/направление/количество шагов)  
- DC двигатели (включение/выключение, направление)  

✅ **Мониторинг энкодеров:**  
- Отображение текущего угла и дельты изменения  
- Автоматический подсчет полных оборотов  
- Визуализация в реальном времени с цветовой индикацией  

✅ **Администрирование:**  
- Смена Node ID энкодеров  
- Обнуление позиции энкодера  
- Диагностика CAN-шины  

## Требования  
- Raspberry Pi с активным CAN-интерфейсом  
- Python 3.10+  
- Зависимости:  
  ```bash
  python-can==4.3.0
  canopen==2.2.0
  pyserial==3.5
  tkinter
  ```

## Установка  
1. Клонируйте репозиторий:  
   ```bash
   git clone https://github.com/yourname/CANMotorControl.git
   cd CANMotorControl
   ```

2. Настройте CAN-интерфейс на Raspberry Pi:  
   ```bash
   sudo ip link set can0 type can bitrate 1000000
   sudo ip link set up can0
   ```

3. Установите зависимости:  
   ```bash
   pip install -r requirements.txt
   ```

## Использование  
1. **Запуск сервера на Raspberry Pi:**  
   ```bash
   python server.py
   ```

2. **Запуск клиента на ПК:**  
   ```bash
   python pc_client.py
   ```

3. **Основные команды в интерфейсе:**  
   - `Показать данные энкодера` - запуск мониторинга  
   - `Сменить ID энкодера` - интерактивный диалог  
   - `Обнулить позицию` - сброс текущего угла  

## Описание файлов

### **`dc_motor.py`**
**Назначение:** Управление двигателем постоянного тока через шину CAN.

**Функционал:**
- Отправка команд на включение/выключение питания и изменение направления вращения.
- Валидация ID мотора (должен быть в диапазоне 2XX/3XX).
- Формирование CAN-сообщений с данными (состояние питания, направление).
- Пример использования через консоль для тестирования (ручной ввод параметров).

---

### **`enc_change_id.py`**
**Назначение:** Изменение Node ID энкодера в CANopen-сети.

**Функционал:**
- Подключение к CAN-сети и изменение Node ID через SDO-запросы.
- Сохранение параметров в EEPROM и перезагрузка узла.
- Проверка допустимого диапазона нового ID (1–127).
- Обработка ошибок связи и автоматическое обновление конфигурации.

---

### **`encoders.py`**
**Назначение:** Мониторинг и управление энкодерами через шину CAN.

**Функционал:**
- Загрузка конфигурации из JSON-файла (разрешение, калибровка, ID энкодеров).
- Расчет угла, дельты и абсолютного положения энкодера.
- Сброс позиции через Preset Value (объект 0x6003).
- Режим реального времени с выводом данных в консоль.
- Поддержка управления через клавиатуру (сброс, активация движения).

---

### **`server.py`**
**Назначение:** Сервер для управления устройствами через сеть.

**Функционал:**
- Прием TCP-подключений от клиентов.
- Обработка команд:
  - Запуск/остановка мониторинга энкодеров.
  - Изменение Node ID энкодера.
  - Сброс позиции энкодера.
  - Управление шаговым и DC-двигателями.
- Рассылка данных энкодеров клиентам в реальном времени.
- Интеграция с классами `MultiEncoderMonitor`, `MoveStepMotor` и другими.

---

### **`step_motor.py`**
**Назначение:** Управление шаговым двигателем через шину CAN.

**Функционал:**
- Отправка команд с параметрами: питание, направление, количество шагов.
- Ожидание подтверждения от двигателя (ответ с ID 0x101 и байтом 0xAA).
- Проверка корректности входных данных (0 ≤ шаги ≤ 1024).
- Пример использования через консоль для тестирования.

---

### **`client.py`**
**Назначение:** Графический интерфейс для удаленного управления.

**Функционал:**
- Подключение к серверу по IP-адресу.
- Управление энкодерами:
  - Смена Node ID.
  - Сброс позиции.
- Управление моторами:
  - Шаговый двигатель (питание, направление, шаги).
  - DC-двигатель (ID, питание, направление).
- Отображение данных энкодеров в реальном времени.
- Логирование статуса операций в текстовом поле.

---

## Взаимодействие компонентов

- **Сервер (`server.py`)** выступает промежуточным звеном между клиентом и устройствами.
- **Клиент (`client.py`)** отправляет команды через TCP, а сервер делегирует их соответствующим модулям:
  - `dc_motor.py` и `step_motor.py` для управления двигателями.
  - `encoders.py` и `enc_change_id.py` для работы с энкодерами.

Все компоненты используют шину CAN для взаимодействия с физическими устройствами.

---


## Лицензия  
Подробности в файле [LICENSE](LICENSE)
